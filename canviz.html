<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" type="image/x-icon" href="canvasIco.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Canvas Legbutt</title>
    <style>
      #field {
        width: 300px;
        height: 300px;
        background-color: black;
        position: relative;
      }

      #player {
        position: absolute;
        left: 150;
        top: 150;
      }
      #ring {
          position: absolute;
          left:30;
          top: 30;
      }
    </style>
  </head>
  <body>
    <div style="text-align:center;">
      <img src="CanvasLegbutt.jpg"></img>
    </div>
    <div id="field" style="margin: 0 auto;">
      <img id="player" src="" width="20" height="20">
      <img id="ring" src="" width="20" height="20">
    </div>
    <div style="text-align:center">
        <div id="score" style="text-align:center">Coins: 0</div>
        <div style="text-align:center">
        <button type="button" id="upButton">^</button>
        </div>
        <button type="button" id="leftButton"><</button>
        <button type="button" id="downButton">v</button>
        <button type="button" id="rightButton">></button>
    </div>
  </body>
</html>

<script>

function randCoord() {
  const min = 10;
  const max = 270;
  const increment = 20;
  
  const randomInt1 = Math.floor(Math.random() * ((max - min) / increment + 1)) * increment + min;
  
  let randomInt2 = Math.floor(Math.random() * ((max - min) / increment + 1)) * increment + min;
  while (randomInt2 === randomInt1) {
    randomInt2 = Math.floor(Math.random() * ((max - min) / increment + 1)) * increment + min;
  }
  
  return [randomInt1, randomInt2];
}

function checkCoinCollide(){
  console.log("checking collision...");
  if (playerX == ringX && playerY == ringY){
    //collision, relocate coin
    playerScore+=1;
    score.innerHTML=`Coins: ${playerScore}`;
    console.log("collision!");
    newCoords = randCoord();
    ringX = newCoords[0];
    ringY = newCoords[1];
    ringImg.style.top = `${ringY}px`;
    ringImg.style.left = `${ringX}px`;
  }
  else {
    console.log("did not collide...");
  }
};


// set the initial scale for mobile devices
const viewportMeta = document.querySelector('meta[name="viewport"]');
viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');

//score
score = document.getElementById('score');
playerScore = 0;

// set up player image
const playerImg = document.getElementById('player');
playerImg.src = "peckRight.png";//change to peckLeft.jpg when player go left

// set up player position and movement
let playerX = 150;
let playerY = 150;
playerImg.style.top = `${playerY}px`;
playerImg.style.left = `${playerX}px`;

//set up rings for player to pick up
ringX = 90;
ringY = 90;
ringImg = document.getElementById('ring');
ringImg.src="ring.png";
ringImg.style.top = `${ringX}px`;
ringImg.style.left = `${ringY}px`;


// function to handle button clicks/touches
function movePlayer(direction) {
  // move player up
  if (direction === 'up' && playerY > 10) {
    playerY -= 20;
    playerImg.style.top = `${playerY}px`;
  }

  // move player down
  if (direction === 'down' && playerY < 270) {
    playerY += 20;
    playerImg.style.top = `${playerY}px`;
  }

  // move player left
  if (direction === 'left' && playerX > 10) {
    playerX -= 20;
    playerImg.src = "peckLeft.png"
    playerImg.style.left = `${playerX}px`;
  }

  // move player right
  if (direction === 'right' && playerX < 270) {
    playerX += 20;
    playerImg.src = "peckRight.png";
    playerImg.style.left = `${playerX}px`;
  }
  checkCoinCollide();
}

// add click/touch listeners for directional buttons
document.getElementById('upButton').addEventListener('click', () => movePlayer('up'));
document.getElementById('downButton').addEventListener('click', () => movePlayer('down'));
document.getElementById('leftButton').addEventListener('click', () => movePlayer('left'));
document.getElementById('rightButton').addEventListener('click', () => movePlayer('right'));
document.getElementById('upButton').addEventListener('touchstart', () => movePlayer('up'));
document.getElementById('downButton').addEventListener('touchstart', () => movePlayer('down'));
document.getElementById('leftButton').addEventListener('touchstart', () => movePlayer('left'));
document.getElementById('rightButton').addEventListener('touchstart', () => movePlayer('right'));

// add arrow key listener for desktop users
document.addEventListener('keydown', (event) => {
  switch (event.key) {
    case 'ArrowUp':
      movePlayer('up');
      break;
    case 'ArrowDown':
      movePlayer('down');
      break;
    case 'ArrowLeft':
      movePlayer('left');
      break;
    case 'ArrowRight':
      movePlayer('right');
      break;
    default:
      break;
  }; 
});

</script>
